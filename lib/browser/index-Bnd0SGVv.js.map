{"version":3,"file":"index-Bnd0SGVv.js","sources":["../../../streamlit/frontend/lib/src/components/elements/ImageList/styled-components.ts","../../../streamlit/frontend/lib/src/components/elements/ImageList/ImageList.tsx"],"sourcesContent":["/**\n * Copyright (c) Streamlit Inc. (2018-2022) Snowflake Inc. (2022-2025)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport styled from \"@emotion/styled\"\n\nexport const StyledImageList = styled.div<{\n  shouldStretch?: boolean\n}>(({ theme, shouldStretch }) => ({\n  display: \"flex\",\n  flexDirection: \"row\",\n  flexWrap: \"wrap\",\n  // Not supported in Safari, but at least it's not a regression for those users:\n  rowGap: theme.spacing.lg,\n  maxWidth: \"100%\",\n  width: shouldStretch ? \"100%\" : \"fit-content\",\n}))\n\nexport const StyledImageContainer = styled.div<{\n  shouldStretch?: boolean\n}>(({ theme, shouldStretch }) => ({\n  display: \"flex\",\n  flexDirection: \"column\",\n  alignItems: \"stretch\",\n  width: shouldStretch ? \"100%\" : \"auto\",\n  flexGrow: shouldStretch ? 1 : 0,\n\n  \">img\": {\n    borderRadius: theme.radii.default,\n  },\n}))\n\nexport const StyledCaption = styled.div(({ theme }) => ({\n  textAlign: \"center\",\n  marginTop: theme.spacing.xs,\n  wordWrap: \"break-word\",\n  padding: theme.spacing.threeXS,\n}))\n","/**\n * Copyright (c) Streamlit Inc. (2018-2022) Snowflake Inc. (2022-2025)\n * Copyright (c) Yuichiro Tachibana (Tsuchiya) (2022-2024)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { CSSProperties, memo, ReactElement } from \"react\"\n\nimport { getLogger } from \"loglevel\"\n\nimport {\n  ImageList as ImageListProto,\n  Image as ImageProto,\n  streamlit,\n} from \"@streamlit/protobuf\"\n\nimport { ElementFullscreenContext } from \"~lib/components/shared/ElementFullscreen/ElementFullscreenContext\"\nimport { withFullScreenWrapper } from \"~lib/components/shared/FullScreenWrapper\"\nimport StreamlitMarkdown from \"~lib/components/shared/StreamlitMarkdown\"\nimport Toolbar, {\n  StyledToolbarElementContainer,\n} from \"~lib/components/shared/Toolbar\"\nimport { useCrossOriginAttribute } from \"~lib/hooks/useCrossOriginAttribute\"\nimport { useRequiredContext } from \"~lib/hooks/useRequiredContext\"\nimport { StreamlitEndpoints } from \"~lib/StreamlitEndpoints\"\n\nimport { useStliteMediaObjects } from \"@stlite/kernel\"\n\nimport {\n  StyledCaption,\n  StyledImageContainer,\n  StyledImageList,\n} from \"./styled-components\"\n\nconst LOG = getLogger(\"ImageList\")\n\n/**\n * @deprecated This is deprecated, but we want to support old versions of the\n * proto messages due to requirements of our integrations.\n */\nexport enum WidthBehavior {\n  OriginalWidth = -1,\n  /** @deprecated */\n  ColumnWidth = -2,\n  /** @deprecated */\n  AutoWidth = -3,\n  MinImageOrContainer = -4,\n  MaxImageOrContainer = -5,\n}\n\nexport interface ImageListProps {\n  endpoints: StreamlitEndpoints\n  element: ImageListProto\n  widthConfig?: streamlit.IWidthConfig | null\n  disableFullscreenMode?: boolean\n}\n\n/**\n * Get the image width based on width configuration (new) or WidthBehavior (legacy).\n * Prioritizes the new widthConfig if both are present.\n *\n * @param widthConfig - The new width configuration from the element\n * @param legacyWidth - The legacy WidthBehavior width from element.width\n * @param containerWidth - The width of the container element\n * @returns The width to use for images, or undefined for original size\n */\nfunction getImageWidth(\n  widthConfig: streamlit.IWidthConfig | null | undefined,\n  legacyWidth: WidthBehavior | null | undefined,\n  containerWidth: number\n): number | undefined {\n  if (widthConfig) {\n    if (widthConfig.useStretch) {\n      return containerWidth\n    }\n\n    if (widthConfig.useContent) {\n      // Use original image size (content width)\n      return undefined\n    }\n\n    if (widthConfig.pixelWidth) {\n      return widthConfig.pixelWidth\n    }\n  }\n\n  // Fall back to legacy WidthBehavior if no new config\n  if (legacyWidth !== null && legacyWidth !== undefined) {\n    switch (legacyWidth) {\n      case WidthBehavior.OriginalWidth:\n      case WidthBehavior.AutoWidth:\n      case WidthBehavior.MinImageOrContainer:\n        // Use original image size\n        return undefined\n\n      case WidthBehavior.ColumnWidth:\n      case WidthBehavior.MaxImageOrContainer:\n        return containerWidth\n\n      default:\n        // Positive integers are exact pixel widths\n        if (legacyWidth > 0) {\n          return legacyWidth\n        }\n        // Unknown negative values default to original size\n        return undefined\n    }\n  }\n\n  // Default fallback: use original image size\n  return undefined\n}\n\nconst Image = ({\n  itemKey,\n  image,\n  imgStyle,\n  buildMediaURL,\n  handleImageError,\n  shouldStretch,\n}: {\n  itemKey: string\n  image: ImageProto\n  imgStyle: CSSProperties\n  buildMediaURL: (url: string) => string\n  handleImageError: (e: React.SyntheticEvent<HTMLImageElement>) => void\n  shouldStretch?: boolean\n}): ReactElement => {\n  const crossOrigin = useCrossOriginAttribute(image.url)\n  return (\n    <StyledImageContainer\n      data-testid=\"stImageContainer\"\n      shouldStretch={shouldStretch}\n    >\n      <img\n        style={imgStyle}\n        src={buildMediaURL(image.url)}\n        alt={itemKey}\n        onError={handleImageError}\n        crossOrigin={crossOrigin}\n      />\n      {image.caption && (\n        <StyledCaption data-testid=\"stImageCaption\" style={imgStyle}>\n          <StreamlitMarkdown\n            source={image.caption}\n            allowHTML={false}\n            isCaption\n            // This is technically not a label but we want the same restrictions\n            // as for labels (e.g. no Markdown tables or horizontal rule).\n            isLabel\n          />\n        </StyledCaption>\n      )}\n    </StyledImageContainer>\n  )\n}\n\n/**\n * Functional element for a horizontal list of images.\n */\nfunction ImageList({\n  element,\n  endpoints,\n  widthConfig,\n  disableFullscreenMode,\n}: Readonly<ImageListProps>): ReactElement {\n  const images = useStliteMediaObjects(element.imgs)\n\n  const {\n    expanded: isFullScreen,\n    width,\n    height: fullScreenHeight,\n    expand,\n    collapse,\n  } = useRequiredContext(ElementFullscreenContext)\n  // The width of the container element, not necessarily the image.\n  const containerWidth = width || 0\n\n  const imageWidth = getImageWidth(widthConfig, element.width, containerWidth)\n\n  const shouldStretch =\n    widthConfig?.useStretch ||\n    (element.width as WidthBehavior) === WidthBehavior.MaxImageOrContainer\n\n  const imgStyle: CSSProperties = {}\n\n  if (fullScreenHeight && isFullScreen) {\n    imgStyle.maxHeight = fullScreenHeight\n    imgStyle.objectFit = \"contain\"\n    // @see issue https://github.com/streamlit/streamlit/issues/10904\n    // Ensure the image tries to fill the width to prevent sizeless SVGs from\n    // not rendering. Let object-fit handle aspect ratio.\n    imgStyle.width = \"100%\"\n  } else {\n    // @see issue https://github.com/streamlit/streamlit/issues/10904\n    // Use imageWidth if defined, otherwise fallback to 100% to prevent sizeless\n    // SVGs from not rendering.\n    imgStyle.width = imageWidth ?? \"100%\"\n    // Cap the image width, so it doesn't exceed its parent container width\n    imgStyle.maxWidth = \"100%\"\n  }\n\n  const handleImageError = (\n    e: React.SyntheticEvent<HTMLImageElement>\n  ): void => {\n    const imageUrl = e.currentTarget.src\n    LOG.error(`Client Error: Image source error - ${imageUrl}`)\n    endpoints.sendClientErrorToHost(\n      \"Image\",\n      \"Image source failed to load\",\n      \"onerror triggered\",\n      imageUrl\n    )\n  }\n\n  return (\n    <StyledToolbarElementContainer\n      width={containerWidth}\n      height={fullScreenHeight}\n      useContainerWidth={isFullScreen}\n      topCentered\n    >\n      <Toolbar\n        target={StyledToolbarElementContainer}\n        isFullScreen={isFullScreen}\n        onExpand={expand}\n        onCollapse={collapse}\n        disableFullscreenMode={disableFullscreenMode}\n      ></Toolbar>\n      <StyledImageList\n        className=\"stImage\"\n        data-testid=\"stImage\"\n        shouldStretch={shouldStretch}\n      >\n        {images.map(\n          (iimage, idx): ReactElement => (\n            <Image\n              // TODO: Update to match React best practices\n              // eslint-disable-next-line @eslint-react/no-array-index-key\n              key={idx}\n              itemKey={idx.toString()}\n              image={iimage as ImageProto}\n              imgStyle={imgStyle}\n              buildMediaURL={(url: string) => endpoints.buildMediaURL(url)}\n              handleImageError={handleImageError}\n              shouldStretch={shouldStretch}\n            />\n          )\n        )}\n      </StyledImageList>\n    </StyledToolbarElementContainer>\n  )\n}\n\nconst ImageListWithFullScreen = withFullScreenWrapper(ImageList)\nexport default memo(ImageListWithFullScreen)\n"],"names":["StyledImageList","_styled","target","theme","shouldStretch","display","flexDirection","flexWrap","rowGap","spacing","lg","maxWidth","width","StyledImageContainer","alignItems","flexGrow","borderRadius","radii","default","StyledCaption","textAlign","marginTop","xs","wordWrap","padding","threeXS","LOG","getLogger","getImageWidth","widthConfig","legacyWidth","containerWidth","useStretch","useContent","pixelWidth","WidthBehavior","undefined","Image","itemKey","image","imgStyle","buildMediaURL","handleImageError","crossOrigin","useCrossOriginAttribute","url","jsxs","jsx","caption","StreamlitMarkdown","ImageList","element","endpoints","disableFullscreenMode","images","useStliteMediaObjects","imgs","expanded","isFullScreen","height","fullScreenHeight","expand","collapse","useRequiredContext","ElementFullscreenContext","imageWidth","maxHeight","objectFit","e","imageUrl","currentTarget","src","error","sendClientErrorToHost","StyledToolbarElementContainer","Toolbar","map","iimage","idx","toString","ImageListWithFullScreen","withFullScreenWrapper","ImageList_default","memo"],"mappings":"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"}
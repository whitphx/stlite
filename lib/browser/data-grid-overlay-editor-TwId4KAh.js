import{r,b as z}from"./index-BEMuuzwg.js";import{s as J,i as P,a as Q,b as U,T as Z,C as _,m as ee}from"./index-BXRAvcF-.js";const te=()=>t=>t.targetX,re=()=>t=>t.targetY,ie=()=>t=>t.targetWidth,ae=()=>t=>t.targetHeight,ne=()=>t=>t.targetY+10,oe=()=>t=>Math.max(0,(t.targetHeight-28)/2),se=J("div")({name:"DataGridOverlayEditorStyle",class:"gdg-d19meir1",propsAsIs:!1,vars:{"d19meir1-0":[re(),"px"],"d19meir1-1":[te(),"px"],"d19meir1-2":[ie(),"px"],"d19meir1-3":[ae(),"px"],"d19meir1-4":[ne(),"px"],"d19meir1-5":[oe(),"px"]}});function de(){const[t,n]=r.useState();return[t??void 0,n]}function le(){const[t,n]=de(),[a,p]=r.useState(0),[m,C]=r.useState(!0);r.useLayoutEffect(()=>{if(t===void 0||!("IntersectionObserver"in window))return;const o=new IntersectionObserver(s=>{s.length!==0&&C(s[0].isIntersecting)},{threshold:1});return o.observe(t),()=>o.disconnect()},[t]),r.useEffect(()=>{if(m||t===void 0)return;let o;const s=()=>{const{right:w}=t.getBoundingClientRect();p(f=>Math.min(f+window.innerWidth-w-10,0)),o=requestAnimationFrame(s)};return o=requestAnimationFrame(s),()=>{o!==void 0&&cancelAnimationFrame(o)}},[t,m]);const k=r.useMemo(()=>({transform:`translateX(${a}px)`}),[a]);return{ref:n,style:k}}const ce=t=>{const{target:n,content:a,onFinishEditing:p,forceEditMode:m,initialValue:C,imageEditorOverride:k,markdownDivCreateNode:o,highlight:s,className:w,theme:f,id:W,cell:x,bloom:u,validateCell:d,getCellRenderer:M,provideEditor:h,isOutsideClick:X}=t,[l,Y]=r.useState(m?a:void 0),O=r.useRef(l??a);O.current=l??a;const[y,N]=r.useState(()=>d===void 0?!0:!(P(a)&&(d==null?void 0:d(x,a,O.current))===!1)),g=r.useCallback((e,i)=>{p(y?e:void 0,i)},[y,p]),q=r.useCallback(e=>{if(d!==void 0&&e!==void 0&&P(e)){const i=d(x,e,O.current);i===!1?N(!1):(typeof i=="object"&&(e=i),N(!0))}Y(e)},[x,d]),b=r.useRef(!1),v=r.useRef(void 0),B=r.useCallback(()=>{g(l,[0,0]),b.current=!0},[l,g]),G=r.useCallback((e,i)=>{g(e,i??v.current??[0,0]),b.current=!0},[g]),j=r.useCallback(async e=>{let i=!1;e.key==="Escape"?(e.stopPropagation(),e.preventDefault(),v.current=[0,0]):e.key==="Enter"&&!e.shiftKey?(e.stopPropagation(),e.preventDefault(),v.current=[0,1],i=!0):e.key==="Tab"&&(e.stopPropagation(),e.preventDefault(),v.current=[e.shiftKey?-1:1,0],i=!0),window.setTimeout(()=>{!b.current&&v.current!==void 0&&(g(i?l:void 0,v.current),b.current=!0)},0)},[g,l]),D=l??a,[c,I]=r.useMemo(()=>{var i,V;if(Q(a))return[];const e=h==null?void 0:h(a);return e!==void 0?[e,!1]:[(V=(i=M(a))==null?void 0:i.provideEditor)==null?void 0:V.call(i,a),!1]},[a,M,h]),{ref:L,style:$}=le();let R=!0,A,H=!0,E;if(c!==void 0){R=c.disablePadding!==!0,H=c.disableStyling!==!0;const e=U(c);e&&(E=c.styleOverride);const i=e?c.editor:c;A=r.createElement(i,{isHighlighted:s,onChange:q,value:D,initialValue:C,onFinishedEditing:G,validatedSelection:P(D)?D.selectionRange:void 0,forceEditMode:m,target:n,imageEditorOverride:k,markdownDivCreateNode:o,isValid:y,theme:f})}E={...E,...$};const F=document.getElementById("portal");if(F===null)return console.error('Cannot open Data Grid overlay editor, because portal not found.  Please add `<div id="portal" />` as the last child of your `<body>`.'),null;let S=H?"gdg-style":"gdg-unstyle";y||(S+=" gdg-invalid"),R&&(S+=" gdg-pad");const K=(u==null?void 0:u[0])??1,T=(u==null?void 0:u[1])??1;return z.createPortal(r.createElement(Z.Provider,{value:f},r.createElement(_,{style:ee(f),className:w,onClickOutside:B,isOutsideClick:X},r.createElement(se,{ref:L,id:W,className:S,style:E,as:I===!0?"label":void 0,targetX:n.x-K,targetY:n.y-T,targetWidth:n.width+K*2,targetHeight:n.height+T*2},r.createElement("div",{className:"gdg-clip-region",onKeyDown:j},A)))),F)};export{ce as default};
